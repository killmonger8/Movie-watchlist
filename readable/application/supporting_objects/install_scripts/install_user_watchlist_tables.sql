CREATE TABLE "MOVIE_USERS" 
   (	"ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOT NULL ENABLE, 
	"USERNAME" VARCHAR2(255 CHAR), 
	"CREATED" DATE NOT NULL ENABLE, 
	"CREATED_BY" VARCHAR2(255 CHAR) NOT NULL ENABLE, 
	"UPDATED" DATE NOT NULL ENABLE, 
	"UPDATED_BY" VARCHAR2(255 CHAR) NOT NULL ENABLE, 
	 CONSTRAINT "MOVIE_USERS_ID_PK" PRIMARY KEY ("ID")
  USING INDEX  ENABLE, 
	 CONSTRAINT "MOVIE_USERS_USERNAME_UNQ" UNIQUE ("USERNAME")
  USING INDEX  ENABLE
   ) ;

CREATE TABLE "WATCHLIST" 
   (	"ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOT NULL ENABLE, 
	"MOVIE_ID" NUMBER, 
	"USER_ID" NUMBER, 
	"WATCHED_YN" VARCHAR2(1 CHAR), 
	"WATCHED" DATE, 
	"TITLE" VARCHAR2(4000 CHAR), 
	"POSTER_URL" VARCHAR2(4000 CHAR), 
	"RELEASE_DATE" DATE, 
	"RUNTIME" NUMBER, 
	"VOTE_AVERAGE" NUMBER, 
	"CREATED" DATE NOT NULL ENABLE, 
	"CREATED_BY" VARCHAR2(255 CHAR) NOT NULL ENABLE, 
	"UPDATED" DATE NOT NULL ENABLE, 
	"UPDATED_BY" VARCHAR2(255 CHAR) NOT NULL ENABLE, 
	 CONSTRAINT "WATCHLIST_WATCHED_YN_CK" CHECK (watched_yn in ('Y','N')) ENABLE, 
	 CONSTRAINT "WATCHLIST_ID_PK" PRIMARY KEY ("ID")
  USING INDEX  ENABLE, 
	 CONSTRAINT "WATCHLIST_UK" UNIQUE ("MOVIE_ID", "USER_ID")
  USING INDEX  ENABLE
   ) ;

ALTER TABLE "WATCHLIST" ADD CONSTRAINT "WATCHLIST_USER_ID_FK" FOREIGN KEY ("USER_ID")
	  REFERENCES "MOVIE_USERS" ("ID") ON DELETE CASCADE ENABLE;

CREATE INDEX "WATCHLIST_I1" ON "WATCHLIST" ("USER_ID") 
  ;

CREATE OR REPLACE EDITIONABLE TRIGGER "MOVIE_USERS_BIU" 
    before insert or update  
    on movie_users 
    for each row 
begin 
    if inserting then 
        :new.created := sysdate; 
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user); 
    end if; 
    :new.updated := sysdate; 
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user); 
end movie_users_biu; 

/


ALTER TRIGGER "MOVIE_USERS_BIU" ENABLE;

CREATE OR REPLACE EDITIONABLE TRIGGER "WATCHLIST_BIU" 
    before insert or update  
    on watchlist 
    for each row 
begin 
    if inserting then 
        :new.created := sysdate; 
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user); 
    end if; 
    :new.updated := sysdate; 
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user); 
end watchlist_biu; 

/


ALTER TRIGGER "WATCHLIST_BIU" ENABLE;

